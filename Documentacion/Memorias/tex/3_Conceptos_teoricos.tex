\capitulo{3}{Conceptos teóricos}

\section{Espacios de color }
El color que percibimos en los objetos que nos rodean depende de la radiación reflejada en ellos. Según los estudios, nosotros como humanos tenemos un rango ``de luz visible'', ese rango son en verdad tres frecuencias diferentes dentro del rango 769THz a 384THz~\cite{Manual:HAE}.\\
Por lo que en verdad una imagen que percibimos es la unión de las tres frecuencias diferentes y para poder simular este hecho las maquinas simulan esta capacidad innata de los humanos creando los espacios de color que son modelos matemáticos para representar en una maquina lo que se observa en la figura \ref{fig:3.1}.

\begin{figure}[h]
\centering
\includegraphics[width=.9\textwidth]{EspacioDeColor}
\caption{Frecuencias de luz visible \cite{Manual:HAE}}
\label{fig:3.1}
\end{figure}

\subsection{RGB}
El modelo RGB es usado por todos los sistemas digitales para la representación y captura de imágenes.\\
Se divide en tres canales como se muesra en la figura \ref{fig:3.2}\\
\begin{itemize}
	\item R: canal del rojo (RED) contiene la intensidad de rojo de cada pixel\\
	\item G: canal del verde (GREEN) contiene la intensidad de verde de cada pixel\\
	\item B: canal del azul (BLUE) contiene la intensidad de azul de cada pixel\\ 
\end{itemize}

\begin{figure}[h]
\centering
\includegraphics[width=.3\textwidth]{RGB_Canales}
\caption{Los tres canales del espacio RGB \cite{Manual:HAE}}
\label{fig:3.2}
\end{figure}
La combinación de estos colores crea todas la gama de colores representable.
El valor de la intensidad de cada canal depende de la codificación usada para su representación (Ocho bits dan Dieciséis millones de colores) como se muestra en la figura  \ref{fig:3.3}

\begin{figure}[h]
\centering
\includegraphics[width=.3\textwidth]{RGB}
\caption{Representación del modelo RGB\cite{Manual:HAE}}
\label{fig:3.3}
\end{figure}

\subsection{HSV}
El modelo HSV \cite{modelo:hsv} esta orientado a la descripción de los colores en términos mas prácticos para el ser humano que el RGB, los canales significan algo mas que la cantidad de cada color, por lo que es mas practico para el ser humano.Lo que se observa en la figura \ref{fig:3.4}.
 
\begin{itemize}
	\item H: (Matiz) que representa el tono o color.\\
	\item S: (Saturación) representa el nivel de saturación de un color.\\
	\item V: (Brillo) representa la intensidad lumínica.\\
\end{itemize}

\begin{figure}[h]
\centering
\includegraphics[width=.35\textwidth]{HSV}
\caption{Representación del modelo HSV\cite{Manual:HAE}}
\label{fig:3.4}
\end{figure}

Una ventaja con otros espacios de color parecidos es que este permite representar todas las combinaciones del espacio RGB.

\section{Transformada de Hough }

Uno de los puntos relevantes del proyecto es la detección de las líneas pintadas o detectadas por el algoritmo (modo automático) para ello vamos a usar una técnica que sirve para detectar formas, expresadas de forma matemática, dentro de imágenes.

Esta técnica fue inventada por Richard Duda y Peter Hart en 1972 pero diez años antes, Paul Hough propuso y patentó \cite{pat:patHough} la idea inicial de detectar líneas en la imagen. Mas tarde se generalizó para detectar cualquier figura.

\subsection{Teoría}

Normalmente para detectar figuras sencillas en una imagen primero hay que usar algún algoritmo de detección de bordes o una binarización de la imagen, quedándonos con la región de interés apropiada (los píxeles que forman las rectas) pero normalmente faltan píxeles por el ruido en la imagen.

Para ello el método de Hough propone solucionar el problema detectando grupos de puntos que forman los bordes de la misma figura y así conseguir unirlos creando la recta real a la que pertenecen.

\subsection{Psudocódigo Transformada de Hough}
Como podemos ver en el siguiente Psudocódigo 
\ref{alg:Hough}.

%Hough
\begin{algorithm*}
\DontPrintSemicolon
\KwIn{Imagen}
\KwOut{(list) de segmentos encontrados }

%$ S = \varnothing $

\ForEach {punto en la imagen}{
		\If {punto \textbf{(x,y)} esta en un borde:}{
			\ForEach {angulo en ángulos $\Theta$ }{
				Calcular $\rho$  para el punto (x,y) con angulo $\Theta$ \;
				Incrementar la posición ($\rho$ , $\Theta$ ) en el acumulador\;
			}
		}
}
Buscar las posiciones con mayores valores en el acumulador\;	

\Return {$rectas$ Las rectas cuyos valores son los mayores en el acumulador}
\label{alg:Hough}
\end{algorithm*}

\subsection{Limitaciones}
Para que este proceso sea exitoso, los bordes del objeto deben ser detectados correctamente con un buen pre-procesado de la imagen y aparecer claramente las nubes de puntos que forman las rectas.
Como se muestra en el figura \ref{fig:3.5}.

\begin{figure}[h]
\centering
\includegraphics[width=.3\textwidth]{Hough}
\caption{Líneas de Hough\cite{opencv:HoughIm}}
\label{fig:3.5}
\end{figure}
\subsection{Transformada probabilística de Hough}

Tal y como se explica en \cite{Kiryati20001157}, la transformada probabilística de Hough es una version que se basa en que la detección de bordes o la producción de la imagen binaria que contiene el objeto, podría tener ruido y por lo tanto los píxeles que corresponden al ruido con la transformada normal podrían ser considerados como una recta, cuando en verdad es ruido.\\

Para que unos puntos sean considerados recta en la transformada probabilística, es necesario menos puntos que en la transformada normal de Hough.
Pero este método penaliza a los puntos que se encuentran aleatoriamente por toda la imagen (ruido) frente a los que se localizan perfectamente agrupados formando las rectas. 
Un exceso de ruido en la imagen también haría este método inservible, pero para pequeñas cantidades lo hacen mas preciso que el método normal.
Otra ventaja es que con este método obtenemos el segmento que necesitamos, no la prolongación de él hasta el infinito.

\section{Skeletonize }
Tal y como se explica en \cite{scik:skeleton}, dentro del pre-procesado de la imagen, uno de los puntos clave para que nuestro método funcione.
Después de su binarización y la detección de los bordes de la imagen a procesar, debemos reducir la región sobre la que aplicar la transformada de Hough, así conseguiremos que esta sea mas rápida, y detecte menos número de líneas imaginarias por cada línea real.

Esto lo conseguiremos usando una función de esqueletonizado que nos devuelve lo que su nombre indica el esqueleto de los bordes de la imagen reducidos a 1 pixel, Como podemos observar en la imagen \ref{fig:3.6}.


\begin{figure}
\begin{subfigure}[b]{.5\linewidth}
\centering\large \includegraphics[width=.9\textwidth]{skeletonizeA}
\caption{Original}
\end{subfigure}%
\begin{subfigure}[b]{.5\linewidth}
\centering\large \includegraphics[width=.9\textwidth]{skeletonizeB}
\caption{Skeletonizada}
\end{subfigure}
\caption{Ejemplo de eskeletonize.}\label{fig:3.6}
\end{figure}


\section{Grafos}	
\subsection{Introducción}
La teoría de grafos\cite{Wiki:Grafos} en un campo dentro de la computación y de las matemáticas, estudia las propiedades de los grafos que están compuestos por vértices y aristas, que comunican estos los vértices.
Es una rama muy amplia pero solo vamos a centrarnos en uno de los problemas que podemos resolver gracias a estas teorías.

\subsection{K-componentes}
Una de las propiedades del grafo con sus componentes que nos indica cómo de fuertemente conexos están sus vértices, gracias a esta teoría nos aprovechamos que cuando un grafo esta dividido en clusters, agrupaciones fuertemente conexas de parte de sus vértices, por el problema de los k-componentes podemos saber que conjuntos de vértices forman los clusters por lo tanto, aplicado a nuestro problema los vértices que tengan aristas que los comuniquen pertenecerán a las mismas rectas y de cada conjunto de vértices sacaremos una recta.

\section{Bordes}
En lo que nos estamos basando, para poder resolver el problema,
es en la detección de bordes mediante kernels conocidos.
Para poder detectar donde esta el cambio de color en el histograma y esos cambios bruscos de pigmentación son los que nos indican que eso es un borde.
Para ello se han desarrollado numerosos métodos matemáticos que pasando una mascara, por toda la imagen, nos devolverían otra imagen con los bordes llamada mascara.

Como en los anexos donde usamos toda la variedad de ellos que hemos encontrado aquí simplemente los nombraremos.

Kernel \cite{wiki:kernels}: Un kernel es una matriz que se operara con una porcion de pixeles para suavizar o detectar algún elemento que sea de nuestro interés.

\begin{itemize}
\item Laplace \cite{wiki:Laplace}.
\item Prewitt \cite{wiki:Prewitt}.
\item Scharr \cite{jon:Scharr}.
\item Sobel \cite{wiki:Sobel}.
\item Roberts \cite{wiki:Roberts}.
\item Kirsch \cite{wiki:Kirsch}.
\item Gabor \cite{wiki:Gabor}.
\end{itemize}
Aparte de los métodos antes mencionados hemos combinado distintos formas para detectar bordes através de los autovectores \cite{wiki:Eigenvector} largos, de la matriz Hessiana \cite{wiki:Hessiana}.