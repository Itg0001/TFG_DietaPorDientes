\apendice{validación experimental}

Está sección va a tener 2 tipos de test.
Uno primero evalua la calidad del procesado y análisis en términos  de líneas extraidas y como se corresponden estás con las líneas reales.
Y un según test más avanzado va a comparar las propiedades de las lineas extraidas por la aplicación con las extraidas manualmente.

\section{Test de calidad}

En esta parte vamos a evaluar la calidad del proceso de binarización, esqueletizado, extracción de lineas y combinación de segmentos en términos de medidas obtenidas a partir de la matriz de confusión.
En dicha matriz un pixel representado como línea es un positivo y el fondo es negativo. Hay por lo tanto cuatro opciones: <<TP, FP, TN, FN>> como podemos observar en la tabla \ref{tab:ConfMatrix}.

En este apartado vamos a mostrar las medidas que vamos a usar para conseguir la calidad de las imágenes y explicar las formulas obtenidas de \cite{wiki:confMatrix}.

Este primer test evalúa que las lineas reales se correspondan con líneas extraídas, pero no tiene en cuenta el número ni longitud de estas.

\begin{itemize}
\item True positive rate (TPR): Mide la proporción de los elementos que se han considerado como positivos y son positivos.
\[TPR=\frac{TP}{TP+FN}\]

\item True negative rate (TNR):Mide la proporción de los elementos que se han considerado como negativos y son negativos. 
\[TNR=\frac{TN}{FP+TN}\]

\item Positive predictive value (PPV): Mide la proporción de elementos clasificados como verdaderos positivos entre los positivos.
\[PPV=\frac{TP}{TP+FP}\]


\item Negative predictive value (NPV): Mide la proporción de elementos clasificados como verdaderos negativos entre los negativos.  
\[NPV=\frac{TN}{TN+FN}\]


\item False positive rate (FPR):
Mide la proporción de los elementos que se han considerado como falsos positivos entre los que son negativos reales.
 \[FPR=1-TNR\]

\item False discovery rate (FDR):
Mide la proporción de los elementos que se han considerado como falsos positivos entre los que son positivos de verdad.
\[FDR=1-PPV\]

\item Miss rate or false negative rate (FNR):
Mide la proporción de los elementos que se han considerado como falsos negativos entre los que son  positivos. \[FNR=1-TPR\]

\item Accuracy (ACC): Mide el error observable.
\[ACC=\frac{TP+TN}{P+N}\]

\item Valor F1: Este valor muestra la media armónica entre la precision y la sensibilidad del modelo.
\[F1=\frac{2TP}{2TP+FP+FN}\]

\item Matthews correlation coefficient (MCC):
Esta medida se usa en Maching Learning para medir la calidad de la clasificación en dos clases \cite{wiki:machineMCC}.
 \[MCC=\frac{TP*TN-FP*FN}{\sqrt{(TP+FP)*(TP+FN)*(TN+FP)*(TN+FN)}}\]
 
\item Informedness or Bookmaker Informedness (BM):
Esta medida informa de la generalización de un problema multi-clases y estima la probabilidad de decisión.
 \[BM=TPR+TNR-1\]

\item Markedness (MK):
Esta es la medida de cuando una variable es marcada como predicción o causa posible de otra.
 \[MK=PPV+NPV-1\]


\end{itemize}



\subsection{Pruebas}
Aquí van a aparecer una muestra de las pruebas que hemos realizado sobre la aplicación para medir la calidad de la detección.


Para las pruebas vamos a optar por construir una matriz de confusion sobre los resultados, la tabla mostrada a continuación, sera el modelo que vamos a seguir \ref{tab:ConfMatrix}.

\begin{table}
  \begin{center}
    \begin{tabular}{c l c c}
                 &                & \multicolumn{2}{c}{\cellcolor{brown!25}Predicted condition}   \\
                 &                & \cellcolor{brown!15}Positive prediction & \cellcolor{brown!45}Negative prediction \\
       \cellcolor{blue!15}True      & \cellcolor{blue!10}Positive class & \cellcolor{green!25}True positive (TP)  & \cellcolor{red!25}False negative (FN) \\
       \cellcolor{blue!15}Condition & \cellcolor{blue!30}Negative class & \cellcolor{red!25}False positive (FP) & \cellcolor{green!25}True negative (TN)  \\
    \end{tabular}
  \end{center}
  \caption{Estructura de la matriz de confusion.}
  \label{tab:ConfMatrix}
\end{table}


La tabla en general va a contener las medidas que hemos mencionado anteriormente pero vamso a aclarar las medidas.
\begin{itemize}
\item Maximizar: TPR, TNR, PPV, NPV, ACC, F1, MCC, BM y MK.
Estas medidas se corresponden con el número de elementos que debemos maximizar ya que indican tanto aciertos en positivos como en falsos, pero aciertos.
\item Minimizar: FPR, FDR y FNR.
Estas medidas las cuanto menores sean será mejor ya que indicará que no fallamos ni en positivos ni en negativos.
\end{itemize}

Prueba 1: La matriz de confusión obtenida para esta prueba la podemos observar en la tabla \ref{tab:pruebas}.
Las imágenes original, como muestra la figura \ref{fig:orip1}, y calculada, como muestra la figura \ref{fig:calcp1}, las podemos observar en la figura \ref{fig:p1}.
Los resultados de las medidas de calidad se muestran en la tabla \ref{tab:parte}.

Prueba 2: La matriz de confusión obtenida para esta prueba la podemos observar en la tabla \ref{tab:pruebas}.
Las imágenes original, como muestra la figura \ref{fig:orip2}, y calculada, como muestra la figura \ref{fig:calcp2}, las podemos observar en la figura \ref{fig:p2}.
Los resultados de las medidas de calidad se muestran en la tabla \ref{tab:parte}.

Prueba 3: La matriz de confusión obtenida para esta prueba la podemos observar en la tabla \ref{tab:pruebas}.
Las imágenes original, como muestra la figura \ref{fig:orip3}, y calculada, como muestra la figura \ref{fig:calcp3}, las podemos observar en la figura \ref{fig:p3}.
Los resultados de las medidas de calidad se muestran en la tabla \ref{tab:parte}.

Prueba 4: La matriz de confusión obtenida para esta prueba la podemos observar en la tabla \ref{tab:pruebas}.
Las imágenes original, como muestra la figura \ref{fig:orip4}, y calculada, como muestra la figura \ref{fig:calcp4}, las podemos observar en la figura \ref{fig:p4}.
Los resultados de las medidas de calidad se muestran en la tabla \ref{tab:parte}.




\begin{table}[]
\centering
\caption{Tabla de resultados matriz de confusión}
\label{tab:pruebas}
\begin{tabular}{@{} lrrrr @{}}
\hline
Prueba                & True positive & False negative & False positive & True negative \\ \hline
Figura \ref{fig:p1} & 36136         & 3840           & 3685           & 1185139       \\ \hline
Figura \ref{fig:p2} & 31670         & 844            & 6514           & 1189772       \\ \hline
Figura \ref{fig:p3} & 23114         & 8238           & 7103           & 1190345       \\ \hline
Figura \ref{fig:p4} & 30284         & 1773           & 14753          & 1181990       \\ \hline
\end{tabular}
\end{table}



\begin{table}[]
\centering
\caption{Resultados medidas de calidad}
\label{tab:parte}
\resizebox{\textwidth}{!}{
\begin{tabular}{@{} lllllllllllllll @{}}
\hline
Prueba                & TPR  & TNR  & PPV  & NPV  & FPR   & FDR  & FNR  & ACC  & F1   & MCC  & BM   & MK   \\ \hline
Figura \ref{fig:p1} & 0.90 & 0.99 & 0.99 & 0.99 & 0.003 & 0.09 & 0.09 & 0.99 & 0.91 & 0.90 & 0.9  & 0.90 \\ \hline
Figura \ref{fig:p2} & 0.97 & 0.99 & 0.83 & 0.99 & 0.17  & 0.17 & 0.02 & 0.99 & 0.90 & 0.90 & 0.83 & 0.82 \\ \hline
Figura \ref{fig:p3} & 0.74 & 0.99 & 0.76 & 0.99 & 0.01  & 0.24 & 0.26 & 0.99 & 0.75 & 0.74 & 0.73 & 0.76 \\ \hline
Figura \ref{fig:p4} & 0.94 & 0.99 & 0.67 & 0.99 & 0.01  & 0.33 & 0.05 & 0.99 & 0.78 & 0.79 & 0.93 & 0.67 \\ \hline
Media & 0.88 & 0.99 & 0.81 & 0.99 & 0.04  & 0.20 & 0.11 & 0.99 & 0.84 & 0.83 & 0.85 & 0.78 \\ \hline
Desviación & 0.10 & 0 & 0.13 & 0 & 0.08  & 0.10 & 0.10 & 0 & 0.08 & 0.08 & 0.08 & 0.09 \\ \hline
\end{tabular}
}
\end{table}



\begin{figure}
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.9\textwidth]{prueba1Ori}
	\caption{Estrías pintadas por el usuario prueba 1.}\label{fig:orip1}
	\end{subfigure}%
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.9\textwidth]{prueba1Detec}
	\caption{Estrías pintadas por la aplicacion prueba 1.}\label{fig:calcp1}
	\end{subfigure}%
	\caption{Imágenes prueba 1}
	\label{fig:p1}
\end{figure}



\begin{figure}
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.99\textwidth]{prueba2Ori}
	\caption{Estrías pintadas por el usuario prueba 2.}\label{fig:orip2}
	\end{subfigure}%
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.99\textwidth]{prueba2Detec}
	\caption{Estrías pintadas por la aplicacion prueba 2.}\label{fig:calcp2}
	\end{subfigure}%
	\caption{Imágenes prueba 2}
	\label{fig:p2}

\end{figure}


\begin{figure}
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.9\textwidth]{prueba3Ori}
	\caption{Estrías pintadas por el usuario prueba 3.}\label{fig:orip3}
	\end{subfigure}%
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.9\textwidth]{prueba3Detec}
	\caption{Estrías pintadas por la aplicacion prueba 3.}\label{fig:calcp3}
	\end{subfigure}%
	\caption{Imágenes prueba 3}
	\label{fig:p3}

\end{figure}



\begin{figure}
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.9\textwidth]{prueba4Ori}
	\caption{Estrías pintadas por el usuario prueba 4.}\label{fig:orip4} 
	\end{subfigure}%
	\begin{subfigure}[c]{.5\linewidth}
	\centering\large \includegraphics[width=.9\textwidth]{prueba4Detec}
	\caption{Estrías pintadas por la aplicacion prueba 4.}\label{fig:calcp4}
	\end{subfigure}%
	\caption{Imágenes prueba 4}
	\label{fig:p4}

\end{figure}

\section{Test t de Student}
En este apartado vamos a hacer pruebas con los resultados obtenidos a mano por nuestros testers de la aplicación y los resultados obtenidos por nuestra aplicación, para ello vamos a hacer <<el test t de Student \cite{wiki:testStude}>>

Dicho test consiste en a partir de dos muestras comprar cuanta varia una de otra obteniendo un resultado entre 0 y 1. El resultado obtenido se puede evaluar de dos modos:
\begin{itemize}
\item Normal: Si el resultado obtenido es mayor de 0,05 significa que las muestras son parecidas y que pasan el test de Student menos estricto.
\item Estricto: Si el resultado obtenido es mayor o igual a 0.1 quiere decir que las dos muestras de población son prácticamente la misma ya que ha pasado el test de Student estricto.
\end{itemize} 

\begin{table}[]
\centering
\caption{Prueba t de Student}
\label{tab:estud}
\begin{tabular}{@{} lrrrrr @{}}
\toprule
\multirow{2}{*}{\textbf{Diente}} & \multicolumn{2}{l}{\textbf{Numero de estrías}} & \multicolumn{2}{l}{\textbf{Longitud promedio}} & \multirow{2}{*}{\textbf{Prueba T}} \\ \cline{2-5}
                                 & \textbf{Automático}      & \textbf{Manual}     & \textbf{Automático}      & \textbf{Manual}     &                                    \\ \midrule
\textbf{7506-1}                  & 85,00                    & 80,00               & 339,76                   & 275,88              & 0,19                               \\ \midrule
\textbf{7506-2}                  & 50,00                    & 55,00               & 269,17                   & 271,00              & 0,96                               \\ \midrule
\textbf{7547-1}                  & 23,00                    & 21,00               & 300,00                   & 327,00              & 0,77                               \\ \midrule
\textbf{7547-3}                  & 24,00                    & 24,00               & 263,70                   & 260,00              & 0,94                               \\ \midrule
\textbf{7672-1}                  & 83,00                    & 75,00               & 202,77                   & 230,57              & 0,21                               \\ \midrule
\textbf{7672-3}                  & 56,00                    & 52,00               & 211,93                   & 231,00              & 0,64                               \\ \midrule
\textbf{7672B-1}                 & 65,00                    & 66,00               & 221,66                   & 233,00              & 0,64                               \\ \midrule
\textbf{7672B-2}                 & 71,00                    & 69,00               & 215,86                   & 244,26              & 0,34                               \\ \midrule
\textbf{7711-1}                  & 93,00                    & 76,00               & 195,07                   & 269,00              & 0,10                               \\ \midrule
\textbf{7711-3}                  & 88,00                    & 80,00               & 188,71                   & 237,00              & 0,09                               \\ \bottomrule
\end{tabular}
\end{table}